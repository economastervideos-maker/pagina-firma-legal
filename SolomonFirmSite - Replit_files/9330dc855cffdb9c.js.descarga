;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="1f71e953-667d-a5cb-21a1-9c87d453c8e4")}catch(e){}}();
(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,574831,e=>{"use strict";var n=(0,e.i(389959).createContext)(null);e.s(["default",0,n])},529810,e=>{"use strict";var n=e.i(389959),t=e.i(574831);function r(){var e=(0,n.useContext)(t.default);if(!e)throw Error("Expected services in context");return e}e.s(["default",()=>r])},761732,e=>{"use strict";var n=e.i(530658),t=e.i(389959);e.s(["default",0,function(e){var r=(0,n._)((0,t.useState)(function(){return e?e.current:null}),2),o=r[0],i=r[1];return(0,t.useEffect)(function(){if(i(function(){return e?e.current:null}),e)return e.subscribe(function(e){return i(function(){return e})})},[e]),o}])},716636,66718,827456,e=>{"use strict";var n,t=((n={}).CloudServices="Cloud Services",n.Collaboration="Collaboration",n.WorkspaceFeatures="Workspace Features",n.WorkspaceExtensions="Workspace Extensions",n.Other="Other",n);e.s(["PaneCategory",()=>t],716636);var r=e.i(721281),o=e.i(188507),i=e.i(205104),a=e.i(903381);function s(e){var n=e.path;return n?(0,i.isBinary)(n)?"binary":(0,i.isMedia)(n)?"media":(0,i.isDrawFile)(n)?"draw":"codeEditor":"codeEditor"}function u(e){return"codeEditor"===e||"binary"===e||"media"===e||"draw"===e||"history"===e}function l(e){var n=[],t=!0,r=!1,o=void 0;try{for(var i,u=e[Symbol.iterator]();!(t=(i=u.next()).done);t=!0){var l=i.value;l.type===a.FileType.File&&n.push({type:s({path:l.path}),data:{path:l.path}})}}catch(e){r=!0,o=e}finally{try{t||null==u.return||u.return()}finally{if(r)throw o}}return n}function c(e){return u(e.type)}function d(e){return c(e)?e.data.path:null}function f(e){return!c(e)&&"markdown"!==e.type}function p(e){return"extension"===e.type}var x=new Set(["extensionStore","vnc","automations","runnerOutput","git","envEditor","tutorial","database","neon","replAuth","preferences","deployments","ghostwriterChat","extensionDevtools","objectStorage","workflows","project","config","agentProgress","agentChat","replitAuth","securityScan","developer"]);function v(e){return x.has(e)}var m=(0,r._)({},o.StackBlueprint.STACK_BLUEPRINT_AGENT,"automations");e.s(["STACK_TO_OUTPUT_PANE_MAP",()=>m,"fsNodeToPanes",()=>l,"getFilePathForPane",()=>d,"getPaneTypeForFile",()=>s,"isExtensionPane",()=>p,"isFilePane",()=>c,"isFilePaneType",()=>u,"isSingleton",()=>v,"isToolPane",()=>f],66718);var g=e.i(878420),E=e.i(276385),h=e.i(389959),I={type:"commands",data:{autoFocus:!1}};function _(e){var n=e.config,t=e.filePaneFlag,r=void 0!==t&&t;function o(e){return r&&c(e)?"codeEditor"===e.type||"history"===e.type?{type:"file",data:(0,g._)({type:"codeEditor"},e.data)}:{type:"file",data:(0,g._)({type:e.type},e.data)}:e}return{Icon:function(e){var t=e.pane,r=e.size,i=e.color,a=o(t),s=n[a.type]?a:I,u=n[s.type].Icon;return(0,E.jsx)(u,{pane:s,size:void 0===r?16:r,color:i})},Content:function(e){var t=e.pane,r=e.options,i=o(t),a=n[i.type]?i:I,s=n[a.type].Content;return(0,E.jsx)(s,{pane:a,options:r})},getTitle:function(e){var t=o(e),r=n[t.type]?t:I;return n[r.type].getTitle(r)},getTitlePill:function(e){var t,r=o(e),i=n[r.type]?r:I,a=n[i.type];return null==(t=a.getTitlePill)?void 0:t.call(a,i)},getDescription:function(e,t){var r=o(e),i=n[r.type]?r:I,a=n[i.type].description;return(null==t?void 0:t.short)&&a?a.split(/[a-zA-Z0-9]\. /)[0].trim():a},getCategory:function(e){var t=o(e),r=n[t.type]?t:I;return n[r.type].category},decode:function(e,t){var r,o=null;try{o=null==(r=n[e])?void 0:r.decode(t)}catch(e){}return o}}}var y=(0,h.createContext)(null);function b(){var e=(0,h.useContext)(y);if(!e)throw Error("Expected PaneUI in context");return e}var A=y.Provider;e.s(["PaneUIContextProvider",()=>A,"createPaneUI",()=>_,"usePaneUIContext",()=>b],827456)},545880,(e,n,t)=>{var r=e.r(279732),o=e.r(937657),i=e.r(595146),a=e.r(763377),s=e.r(713331);n.exports=function(e,n,t,u){if(!a(e))return e;n=o(n,e);for(var l=-1,c=n.length,d=c-1,f=e;null!=f&&++l<c;){var p=s(n[l]),x=t;if("__proto__"===p||"constructor"===p||"prototype"===p)break;if(l!=d){var v=f[p];void 0===(x=u?u(v,p,f):void 0)&&(x=a(v)?v:i(n[l+1])?[]:{})}r(f,p,x),f=f[p]}return e}},643607,(e,n,t)=>{var r=e.r(493103),o=e.r(545880),i=e.r(937657);n.exports=function(e,n,t){for(var a=-1,s=n.length,u={};++a<s;){var l=n[a],c=r(e,l);t(c,l)&&o(u,i(l,e),c)}return u}},739721,(e,n,t)=>{var r=e.r(643607),o=e.r(718645);n.exports=function(e,n){return r(e,n,function(n,t){return o(e,t)})}},294061,(e,n,t)=>{var r=e.r(848616),o=e.r(253536),i=e.r(724975);n.exports=function(e){return i(o(e,void 0,r),e+"")}},810547,(e,n,t)=>{var r=e.r(739721);n.exports=e.r(294061)(function(e,n){return null==e?{}:r(e,n)})},8808,e=>{"use strict";e.i(963146);var n=e.i(530448);e.s(["ConnectionState",()=>n.ConnectionState])},475032,873379,e=>{"use strict";var n=e.i(530658),t=e.i(389959),r=e.i(993796),o=e.i(701085);e.i(792e3);var i=e.i(8808);function a(e){var r=(0,n._)((0,t.useState)(e.getConnectionState()),2),o=r[0],i=r[1];return(0,t.useEffect)(function(){return e.onConnectionStateChanged(i)},[e]),o}function s(e){var s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{fallbackToReplCo:!0},u=a(e),l=(0,n._)((0,t.useState)(null),2),c=l[0],d=l[1],f=(0,n._)((0,t.useState)(!0),2),p=f[0],x=f[1],v=(0,n._)((0,t.useState)(!0),2),m=v[0],g=v[1],E=(0,r.useFlag)({controlName:"flag-webview-fallback-url"});return(0,t.useEffect)(function(){if(e.getConnectionState()===i.ConnectionState.CONNECTED){var n=e.getDotdevUrl();if(n){var t=(0,o.isDotDevReachable)(n),r=(0,o.isDotDevReachable)(null==n?void 0:n.replace(/.replit.dev$/,".repl.co"));if(x(t),g(r),!E||!s.fallbackToReplCo||t)return void d(n);d(n.replace(/.replit.dev$/,".repl.co"))}}},[e,u,E,s]),{url:c,reachability:{dotdev:p,replCo:m}}}e.s(["default",()=>a],873379),e.s(["default",()=>s],475032)},619593,(e,n,t)=>{var r,o=e.r(365738),i="__lodash_hash_undefined__",a=1/0,s=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,u=/^\w*$/,l=/^\./,c=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,d=/\\(\\)?/g,f=/^\[object .+?Constructor\]$/,p="object"==o._(e.g)&&e.g&&e.g.Object===Object&&e.g,x=("undefined"==typeof self?"undefined":o._(self))=="object"&&self&&self.Object===Object&&self,v=p||x||Function("return this")(),m=Array.prototype,g=Function.prototype,E=Object.prototype,h=v["__core-js_shared__"],I=(r=/[^.]+$/.exec(h&&h.keys&&h.keys.IE_PROTO||""))?"Symbol(src)_1."+r:"",_=g.toString,y=E.hasOwnProperty,b=E.toString,A=RegExp("^"+_.call(y).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),S=v.Symbol,w=m.splice,C=j(v,"Map"),L=j(Object,"create"),U=S?S.prototype:void 0,P=U?U.toString:void 0;function M(e){var n=-1,t=e?e.length:0;for(this.clear();++n<t;){var r=e[n];this.set(r[0],r[1])}}function T(e){var n=-1,t=e?e.length:0;for(this.clear();++n<t;){var r=e[n];this.set(r[0],r[1])}}function k(e){var n=-1,t=e?e.length:0;for(this.clear();++n<t;){var r=e[n];this.set(r[0],r[1])}}function F(e,n){for(var t,r,o=e.length;o--;){if(t=e[o][0],t===(r=n)||t!=t&&r!=r)return o}return -1}function O(e,n){var t,r,i=e.__data__;return("string"==(r=void 0===(t=n)?"undefined":o._(t))||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==t:null===t)?i["string"==typeof n?"string":"hash"]:i.map}function j(e,n){var t,r,o,i=null==e?void 0:e[n];return!(!V(i)||(t=i,I&&I in t))&&("[object Function]"==(o=V(r=i)?b.call(r):"")||"[object GeneratorFunction]"==o||function(e){var n=!1;if(null!=e&&"function"!=typeof e.toString)try{n=!!(e+"")}catch(e){}return n}(i)?A:f).test(function(e){if(null!=e){try{return _.call(e)}catch(e){}try{return e+""}catch(e){}}return""}(i))?i:void 0}M.prototype.clear=function(){this.__data__=L?L(null):{}},M.prototype.delete=function(e){return this.has(e)&&delete this.__data__[e]},M.prototype.get=function(e){var n=this.__data__;if(L){var t=n[e];return t===i?void 0:t}return y.call(n,e)?n[e]:void 0},M.prototype.has=function(e){var n=this.__data__;return L?void 0!==n[e]:y.call(n,e)},M.prototype.set=function(e,n){return this.__data__[e]=L&&void 0===n?i:n,this},T.prototype.clear=function(){this.__data__=[]},T.prototype.delete=function(e){var n=this.__data__,t=F(n,e);return!(t<0)&&(t==n.length-1?n.pop():w.call(n,t,1),!0)},T.prototype.get=function(e){var n=this.__data__,t=F(n,e);return t<0?void 0:n[t][1]},T.prototype.has=function(e){return F(this.__data__,e)>-1},T.prototype.set=function(e,n){var t=this.__data__,r=F(t,e);return r<0?t.push([e,n]):t[r][1]=n,this},k.prototype.clear=function(){this.__data__={hash:new M,map:new(C||T),string:new M}},k.prototype.delete=function(e){return O(this,e).delete(e)},k.prototype.get=function(e){return O(this,e).get(e)},k.prototype.has=function(e){return O(this,e).has(e)},k.prototype.set=function(e,n){return O(this,e).set(e,n),this};var R=D(function(e){e=null==(n=e)?"":function(e){if("string"==typeof e)return e;if($(e))return P?P.call(e):"";var n=e+"";return"0"==n&&1/e==-a?"-0":n}(n);var n,t=[];return l.test(e)&&t.push(""),e.replace(c,function(e,n,r,o){t.push(r?o.replace(d,"$1"):n||e)}),t});function D(e,n){if("function"!=typeof e||n&&"function"!=typeof n)throw TypeError("Expected a function");var t=function(){var r=arguments,o=n?n.apply(this,r):r[0],i=t.cache;if(i.has(o))return i.get(o);var a=e.apply(this,r);return t.cache=i.set(o,a),a};return t.cache=new(D.Cache||k),t}D.Cache=k;var N=Array.isArray;function V(e){var n=void 0===e?"undefined":o._(e);return!!e&&("object"==n||"function"==n)}function $(e){return(void 0===e?"undefined":o._(e))=="symbol"||!!e&&(void 0===e?"undefined":o._(e))=="object"&&"[object Symbol]"==b.call(e)}n.exports=function(e,n,t){var r=null==e?void 0:function(e,n){var t;n=!function(e,n){if(N(e))return!1;var t=void 0===e?"undefined":o._(e);return!!("number"==t||"symbol"==t||"boolean"==t||null==e||$(e))||u.test(e)||!s.test(e)||null!=n&&e in Object(n)}(n,e)?N(t=n)?t:R(t):[n];for(var r=0,i=n.length;null!=e&&r<i;)e=e[function(e){if("string"==typeof e||$(e))return e;var n=e+"";return"0"==n&&1/e==-a?"-0":n}(n[r++])];return r&&r==i?e:void 0}(e,n);return void 0===r?t:r}},412284,e=>{"use strict";var n=e.i(530658),t=e.i(276385),r=e.i(389959),o=e.i(541793),i=e.i(161322),a=(0,r.createContext)(null);function s(){return function(){var e=(0,r.useContext)(a);if(!e)throw Error("Expected extensions context");return e}().store}var u=function(e){var n=s();return(0,i.useAtom)(e,{store:n})};function l(e){var n=s();return(0,i.useAtomValue)(e,{store:n})}var c=function(e){var n=s();return(0,i.useSetAtom)(e,{store:n})};function d(e){var i=e.children,s=(0,n._)((0,r.useState)(function(){return(0,o.createStore)()}),1)[0];return(0,t.jsx)(a.Provider,{value:{store:s},children:i})}e.s(["ExtensionStoreProvider",()=>d,"useExtAtom",()=>u,"useExtAtomValue",()=>l,"useExtensionsStore",()=>s,"useSetExtAtom",()=>c])},486289,(e,n,t)=>{var r=e.r(493103),o=e.r(290308);n.exports=function(e,n){return n.length<2?e:r(e,o(n,0,-1))}},440022,(e,n,t)=>{var r=e.r(937657),o=e.r(776327),i=e.r(486289),a=e.r(713331);n.exports=function(e,n){return n=r(n,e),null==(e=i(e,n))||delete e[a(o(n))]}},822216,(e,n,t)=>{var r=e.r(100515);n.exports=function(e){return r(e)?void 0:e}},223664,(e,n,t)=>{var r=e.r(70234),o=e.r(838915),i=e.r(440022),a=e.r(937657),s=e.r(436849),u=e.r(822216),l=e.r(294061),c=e.r(977042);n.exports=l(function(e,n){var t={};if(null==e)return t;var l=!1;n=r(n,function(n){return n=a(n,e),l||(l=n.length>1),n}),s(e,c(e),t),l&&(t=o(t,7,u));for(var d=n.length;d--;)i(t,n[d]);return t})},282890,410793,667279,196380,244719,466497,e=>{"use strict";e.i(716636);var n,t=e.i(66718),r=e.i(827456),o=e.i(297083),i=e.i(167626),a=e.i(878420),s=e.i(64386),u=e.i(530658),l=e.i(817556),c=e.i(389959),d=e.i(541793),f=e.i(810547),p=e.i(15053),x=e.i(9293),v=e.i(316953),m=e.i(253344),g=e.i(837399),E=e.i(858248),h=e.i(709485),I=e.i(475032),_=e.i(529810),y=e.i(567807),b=e.i(346715),A=e.i(131141),S=e.i(619593),w=e.i(125674),C=e.i(412284),L=e.i(721281),U=e.i(223664),P=e.i(664152),M=((n={}).debug="debug",n.info="info",n.warn="warn",n.error="error",n);function T(e,n){var t=function(t){var r,o,i,s,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{logLevel:"debug"},l=null!=(r=(o={},(0,L._)(o,"debug",P.logger.debug),(0,L._)(o,"warn",P.logger.warn),(0,L._)(o,"info",P.logger.info),(0,L._)(o,"error",P.logger.error),o)[u.logLevel])?r:P.logger.debug;(null!=(i=(s={},(0,L._)(s,"debug",console.debug),(0,L._)(s,"warn",console.warn),(0,L._)(s,"info",console.info),(0,L._)(s,"error",console.error),s)[u.logLevel])?i:console.debug)(t,u),l(t,(0,U.default)((0,a._)({},u,e),["replId","logLevel"])),n.onLog((0,a._)({message:t},u,e))};return{context:e,info:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t(e,(0,s._)((0,a._)({},n),{logLevel:"info"}))},warn:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t(e,(0,s._)((0,a._)({},n),{logLevel:"warn"}))},error:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t(e,(0,s._)((0,a._)({},n),{logLevel:"error"}))},createLogger:function(t){return T((0,a._)({},e,t),n)}}}e.s(["LogLevel",()=>M,"createExtensionLogger",()=>T],410793);var k=(0,d.atom)(!1),F=(0,d.atom)([]),O=(0,d.atom)([]),j=(0,d.atom)(null),R=(0,d.atom)(T({extension:!0,isInitialized:!1},{onLog:function(){throw Error("Logged before extension system was initialized.")}})),D=(0,d.atom)([]),N=(0,d.atom)(null,function(e,n,t){var r=e(D);n(D,(0,A.produce)(r,function(e){e.push((0,A.produce)(t,function(n){n.index=e.length})),e.length>1e3&&e.splice(0,e.length-1e3)}))}),V=(0,d.atom)(null,function(e,n){n(D,[])}),$=(0,d.atom)("local:true"),B=(0,d.atom)(function(e){var n=e(D),t=e($);if(!t)return n;var r=t.split(" ").map(function(e){var n=(0,u._)(e.split(":"),2),t=n[0],r=n[1];return t&&void 0===r?function(e){return e.message.toLowerCase().includes(t.toLowerCase())}:t&&""===r?function(e){return void 0!==(0,S.default)(e,t)}:t&&r?function(e){try{return String((0,S.default)(e,t))===r}catch(e){return!1}}:null}).filter(function(e){return null!==e});return n.filter(function(e){return r.every(function(n){return n(e)})})}),z=(0,d.atom)(null,function(e,n,t){return(0,o._)(function(){return(0,l._)(this,function(r){if(e(F).find(function(e){return e.extensionId===t.extensionId}))throw Error("Extension already loaded");return n(F,function(e){return(0,A.produce)(e,function(e){var n,r,o,i,a,s,u,l,c=(r=t.baseUrl,o=t.extensionId,i=t.installationId,a=t.manifest,s=t.enableExperimentalApi,u=t.enableInternalApi,l=t.logger,{baseUrl:r,extensionId:o,installationId:i,manifest:a,isLocal:t.isLocal,stateAtom:(0,d.atom)({error:null,panes:[],scopes:new Set(null==(n=a.scopes)?void 0:n.map(function(e){return e.name})),enableExperimentalApi:s,enableInternalApi:u,commands:new Map}),logger:l});e.push(c)})}),[2]})})()}),K=(0,d.atom)(null,function(e,n,t){return(0,o._)(function(){return(0,l._)(this,function(r){if(e(O).find(function(e){return e.extensionId===t.extensionId||e.installationId===t.installationId||e.baseUrl===t.baseUrl}))throw Error("Extension already loaded");return n(O,function(e){return(0,A.produce)(e,function(e){e.push(t)})}),[2]})})()}),W=(0,d.atom)(null,function(e,n,t){var r=e(O).find(function(e){return e.baseUrl===t});if(r)return r;var o={baseUrl:t,extensionId:(0,m.asExtensionId)((0,p.v4)()),installationId:(0,m.asInstallationId)((0,p.v4)())};return n(O,function(e){return(0,A.produce)(e,function(e){e.push(o)})}),o}),G=(0,d.atom)(null,function(e,n,t){return(0,o._)(function(){return(0,l._)(this,function(e){return n(F,function(e){return(0,A.produce)(e,function(e){var n=e.findIndex(function(e){return"extensionId"in t?e.extensionId===t.extensionId:e.installationId===t.installationId});-1!==n&&e.splice(n,1)})}),[2]})})()}),H=(0,d.atom)(null,function(e,n,t){var r=e(F).find(function(e){return e.extensionId===t.extensionId});if(!r)throw Error("Extension not found");n(r.stateAtom,function(e){return(0,A.produce)(e,function(e){e.error=t.extensionError})})}),X=(0,d.atom)(null,function(e,n,t){var r=t.createCommand.id;if(!t.createCommand.id)throw Error("Expected createCommand to have id");if(!t.createCommand.contributions)throw Error("Expected createCommand to have contributions");n(t.extensionStateAtom,function(e){return(0,A.produce)(e,function(e){e.commands.set(r,t.createCommand)})})}),Q=(0,d.atom)(function(e){return e(F).flatMap(function(n){return(0,b._)(e(n.stateAtom).commands.values())})}),Z=(0,d.atom)(function(e){return e(F).map(function(e){var n;return null==(n=e.manifest.fileHandlers)?void 0:n.map(function(n){return(0,s._)((0,a._)({},n),{extension:e})})}).flat().filter(function(e){return!!e})}),q=(0,d.atom)(function(e){return e(F).map(function(e){var n;return null==(n=e.manifest.tools)?void 0:n.map(function(n){return(0,s._)((0,a._)({},n),{extension:e})})}).flat().filter(function(e){return!!e})});function J(){return(0,C.useExtAtomValue)(F)}function Y(e){return J().find(function(n){return n.installationId===e})}function ee(e){var n=Y(e);return n&&e?n.stateAtom:null}function en(){return(0,C.useExtAtomValue)(Z)}function et(){return(0,C.useExtAtomValue)(q)}function er(e){var n=(0,C.useExtAtomValue)(Q);return(0,w.default)(function(){return n.filter(function(n){return n.contributions.includes(e)})},[n,e])}function eo(){return(0,C.useExtAtomValue)(O)}function ei(){var e=(0,C.useSetExtAtom)(G);return(0,c.useCallback)(function(n){return(0,o._)(function(){return(0,l._)(this,function(t){return e({installationId:n}),[2]})})()},[e])}function ea(){var e=em(),n=e.throwSystemError,t=e.throwExtensionError,r=(0,C.useSetExtAtom)(z),u=(0,C.useExtAtomValue)(R),d=(0,C.useExtensionsStore)();return(0,c.useCallback)(function(e){var c=e.installationId,p=e.forceRefetch,E=void 0===p||p;return(0,o._)(function(){var e,o,p,h,I,_,b,A,S,w,C,L,U,P,M,T,k;return(0,l._)(this,function(l){switch(l.label){case 0:return[4,(0,y.getExtensionUserContext)()];case 1:if(!(e=l.sent())||e.error)return n({friendlyMessage:"Failed to load user context",error:e.error}),[2];if(o=e.result.userHasInternalApiEnabled,!(p=d.get(O).find(function(e){return e.installationId===c})))return[3,3];return[4,(0,y.getExtensionManifest)(p.baseUrl)];case 2:if(h=l.sent(),I=u.createLogger({extensionId:p.extensionId,installationId:p.installationId,local:!0}),h.error)return _=(0,s._)((0,a._)({},p),{manifest:(0,v.createDefaultManifest)(),enableExperimentalApi:!1,enableInternalApi:!1,logger:I.createLogger({extensionName:"Unnamed Extension"}),isLocal:!0}),u.info("Adding extension: ".concat(_.manifest.name),{extensionArgs:(0,f.default)(_,["extensionId","installationId","baseUrl","manifest","enableExperimentalApi","enableInternalApi","isLocal"]),local:_.isLocal,error:!0}),r(_),b="Failed to load extension manifest",(0,i._)(h.error,g.TypeboxError)&&(b=h.error.message),t({extensionId:p.extensionId,installationId:p.installationId,extensionError:{error:h.error,friendlyMessage:b}}),[2];return A=(0,v.hasScope)(h.result,"experimental-api"),S=(0,s._)((0,a._)({},p),{manifest:h.result,enableExperimentalApi:A,enableInternalApi:o,logger:I.createLogger({extensionName:h.result.name}),isLocal:!0}),u.info("Adding extension: ".concat(S.manifest.name),{extensionArgs:(0,f.default)(S,["extensionId","installationId","baseUrl","manifest","enableExperimentalApi","enableInternalApi","isLocal"]),local:!0}),r(S),[3,5];case 3:return[4,(0,y.getExtensionInstallation)(c,E)];case 4:if((w=l.sent()).error)return n({friendlyMessage:"Something went wrong while downloading an extension",error:w.error}),[2];if(!(C=w.result))return n({friendlyMessage:"Extension failed to install",error:Error("Expected installation to be defined")}),[2];if(!(L=C.extension))return n({friendlyMessage:"Extension failed to install",error:Error("Expected extension to be defined")}),[2];if(!L.manifest)return t({extensionId:(0,m.asExtensionId)(L.id),installationId:(0,m.asInstallationId)(C.id),extensionError:{friendlyMessage:"Extension failed to install",error:Error("Expected extension manifest to be defined")}}),[2];if("ExtensionManifestError"===L.manifest.__typename)return t({extensionId:(0,m.asExtensionId)(L.id),installationId:(0,m.asInstallationId)(C.id),extensionError:{friendlyMessage:"An error occurred while loading the extension manifest: ".concat(L.manifest.message),error:Error(L.manifest.message)}}),[2];if(!L.manifest||"ExtensionManifest"!==L.manifest.__typename)return t({extensionId:(0,m.asExtensionId)(L.id),installationId:(0,m.asInstallationId)(C.id),extensionError:{friendlyMessage:"An error occurred while loading the extension manifest",error:Error("Expected extension manifest to be defined")}}),[2];return U=(0,v.asManifest)(L.manifest),P=(0,v.hasScope)(U,"experimental-api"),M=(0,m.asExtensionId)(L.id),T=L.enableInternalApi,k={extensionId:M,installationId:c,manifest:U,baseUrl:(0,x.getValidBaseUrlOrThrow)(L.url),enableExperimentalApi:P,enableInternalApi:o||T,logger:u.createLogger({extensionId:M,installationId:c,extensionName:U.name,local:!1}),isLocal:!1},u.info("Adding extension: ".concat(k.manifest.name),{extensionArgs:(0,f.default)(k,["extensionId","installationId","baseUrl","manifest","enableExperimentalApi","enableInternalApi","isLocal"]),local:!1}),r(k),[2,C];case 5:return[2]}})})()},[r,t,n,d,u])}function es(){var e=ea(),n=em().throwSystemError;return(0,c.useCallback)(function(t){var r=t.extensionId,i=t.replId;return(0,o._)(function(){var t,o,a;return(0,l._)(this,function(s){switch(s.label){case 0:return[4,(0,y.installExtensionMutation)({extensionId:r,replId:i})];case 1:if((a=s.sent()).error)return n({error:a.error,friendlyMessage:"Something went wrong while installing an extension"}),[2];return(0,E.track)(h.events.EXTENSION_USED,{action:"installed",name:null==(o=a.result)||null==(t=o.extension)?void 0:t.name,extensionId:r}),[4,e({installationId:(0,m.asInstallationId)(a.result.id)})];case 2:return s.sent(),[2,a.result]}})})()},[e,n])}function eu(){var e=ei(),n=(0,C.useExtensionsStore)(),t=em().throwSystemError;return(0,c.useCallback)(function(r){var i=r.installationId,a=r.replId;return(0,o._)(function(){var r;return(0,l._)(this,function(o){switch(o.label){case 0:if(!(r=n.get(F).find(function(e){return e.installationId===i})))return t({friendlyMessage:"Extension appears to be already uninstalled",error:Error("Expected extension to be defined")}),[2];if(!r.installationId||!r.extensionId)return t({friendlyMessage:"Failed to uninstall extension",error:Error("Expected installationId to be defined")}),[2];return(0,E.track)(h.events.EXTENSION_USED,{action:"uninstalled",name:r.manifest.name,extensionId:r.extensionId}),[4,(0,y.uninstallExtensionMutation)({installationId:r.installationId,replId:a})];case 1:return o.sent(),[4,e(r.installationId)];case 2:return o.sent(),[2]}})})()},[e,n,t])}function el(){var e=ei(),n=ea();return(0,c.useCallback)(function(t){return(0,o._)(function(){return(0,l._)(this,function(r){switch(r.label){case 0:return[4,e(t)];case 1:return r.sent(),[4,n({installationId:t,forceRefetch:!0})];case 2:return r.sent(),[2]}})})()},[e,n])}function ec(){var e,n,t,r=(e=ea(),n=(0,C.useExtAtomValue)(R),t=em().throwSystemError,(0,c.useCallback)(function(r){return(0,o._)(function(){var o,i,a,s,u,c,d,f,p,x;return(0,l._)(this,function(l){switch(l.label){case 0:return[4,(0,y.getExtensionInstallationsInRepl)(r)];case 1:if((o=l.sent()).error)return t({friendlyMessage:"Failed to load installed extensions",error:o.error}),[2];i=!0,a=!1,s=void 0,l.label=2;case 2:l.trys.push([2,9,10,11]),u=o.result[Symbol.iterator](),l.label=3;case 3:if(i=(c=u.next()).done)return[3,8];if(null==(f=(d=c.value).extension)?void 0:f.isDisabled)return n.info("Skipping disabled extension: ".concat(d.extension.name),{extension:!0,extensionId:d.extension.id,installationId:d.id}),[3,7];l.label=4;case 4:return l.trys.push([4,6,,7]),[4,e({installationId:(0,m.asInstallationId)(d.id),forceRefetch:!0})];case 5:return l.sent(),[3,7];case 6:return p=l.sent(),n.error("Extension Loading error: ".concat(p.message),{extension:!0,errors:p.message}),[3,7];case 7:return i=!0,[3,3];case 8:return[3,11];case 9:return x=l.sent(),a=!0,s=x,[3,11];case 10:try{i||null==u.return||u.return()}finally{if(a)throw s}return[7];case 11:return[2]}})})()},[e,t,n])),i=(0,C.useSetExtAtom)(R),a=(0,C.useSetExtAtom)(N),s=(0,u._)((0,C.useExtAtom)(k),2),d=s[0],f=s[1],p=(0,u._)((0,c.useState)(null),2),x=p[0],v=p[1],g=(0,u._)((0,c.useState)(null),2),E=g[0],h=g[1];return(0,c.useEffect)(function(){if(x&&E&&!d){var e=x.replId;f(!0),r(e)}},[x,E,r,d,f]),(0,c.useCallback)(function(e){var n=e.replId,t=e.userId;if(!d){v({replId:n,userId:t});var r=T({extension:!0,isInitialized:!0,replId:n,userId:t},{onLog:function(e){a(e)}});h(r),i(r)}},[i,a,d])}function ed(){var e=ea(),n=eo(),t=J(),r=(0,C.useSetExtAtom)(K);return(0,c.useCallback)(function(i){return(0,o._)(function(){var o,a;return(0,l._)(this,function(s){return o=(0,x.getValidBaseUrlOrThrow)(i),(a=n.find(function(e){return e.baseUrl===o}))||r(a={extensionId:(0,m.asExtensionId)((0,p.v4)()),installationId:(0,m.asInstallationId)((0,p.v4)()),baseUrl:o}),t.find(function(e){return e.extensionId===(null==a?void 0:a.extensionId)})||e({installationId:a.installationId}),[2]})})()},[n,t,r,e])}function ef(){var e=(0,_.default)().container,n=(0,I.default)(e).url,t=(0,C.useSetExtAtom)(W),r=(0,C.useExtensionsStore)(),i=ea();return(0,c.useCallback)(function(){return(0,o._)(function(){var e;return(0,l._)(this,function(o){switch(o.label){case 0:if(!n)return[2];return[4,i({installationId:(e=t(n)).installationId,forceRefetch:!0})];case 1:return o.sent(),[2,r.get(F).find(function(n){return n.installationId===e.installationId})]}})})()},[n,t,i,r])}function ep(){var e=(0,_.default)().container,n=(0,I.default)(e).url,t=(0,C.useSetExtAtom)(W),r=J();return(0,c.useMemo)(function(){if(n){var e=t(n);return r.find(function(n){return e.installationId===n.installationId})}},[n,r,t])}e.s(["addExtensionAtom",()=>z,"addLocalExtensionAtom",()=>K,"addLogAtom",()=>N,"addOrGetLocalExtensionFromBaseUrlAtom",()=>W,"clearLogsAtom",()=>V,"extensionsAtom",()=>F,"filteredLogsAtom",()=>B,"isExtensionSystemInitializedAtom",()=>k,"localExtensionsAtom",()=>O,"logFilterQueryAtom",()=>$,"registerExtensionCreateCommandAtom",()=>X,"removeExtensionAtom",()=>G,"rootExtensionSystemLoggerAtom",()=>R,"setExtensionErrorAtom",()=>H,"systemErrorAtom",()=>j,"useExtensionByInstallationId",()=>Y,"useExtensionCommands",()=>er,"useExtensionStateAtom",()=>ee,"useExtensionTools",()=>et,"useExtensions",()=>J,"useFileHandlers",()=>en,"useLocallyInstalledExtensions",()=>eo],667279);var ex=(0,d.atom)(null,function(e,n,t){var r=e(R);n(j,t),r.error("Extension System Error: ".concat(t.error.message),{extensionSystem:!0,originalError:t.error.message,friendlyMessage:t.friendlyMessage})}),ev=(0,d.atom)(null,function(e,n,t){var r=e(F),o=e(R),i=r.find(function(e){return e.extensionId===t.extensionId});if(o.error("Extension Error: ".concat(t.extensionError.friendlyMessage),{extension:!0,extensionId:t.extensionId,originalError:t.extensionError.error.message,friendlyMessage:t.extensionError.friendlyMessage}),!i){n(z,{extensionId:t.extensionId,installationId:t.installationId,manifest:(0,v.createDefaultManifest)({name:t.extensionId}),baseUrl:"",enableExperimentalApi:!1,enableInternalApi:!1,logger:o.createLogger({extensionId:t.extensionId,extensionName:t.extensionId,installationId:t.installationId,local:void 0}),isLocal:null}),n(H,{extensionId:t.extensionId,extensionError:t.extensionError});return}n(H,{extensionId:t.extensionId,extensionError:t.extensionError})});function em(){return{throwSystemError:(0,C.useSetExtAtom)(ex),throwExtensionError:(0,C.useSetExtAtom)(ev)}}function eg(e,n){var o=(0,r.usePaneUIContext)().getDescription(e,n),i=Y((0,t.isExtensionPane)(e)?e.data.installationId:void 0);return null!=o?o:null==i?void 0:i.manifest.description}e.s(["useCurrentReplExtension",()=>ep,"useInitializeExtensionSystem",()=>ec,"useInstallCurrentReplAsExtension",()=>ef,"useInstallExtension",()=>es,"useInstallExtensionLocallyByURL",()=>ed,"useLoadExtension",()=>ea,"useReloadExtension",()=>el,"useUninstallExtension",()=>eu,"useUnloadExtension",()=>ei],196380),e.s([],244719),e.s(["usePaneDescription",()=>eg],466497),e.s([],282890)}]);

//# debugId=1f71e953-667d-a5cb-21a1-9c87d453c8e4
//# sourceMappingURL=4f3b4c02719a5fe2.js.map